================================================================================
[001] Add Document Elements with D3
[002] Select a Group of Elements with D3
[003] Work with Data in D3
[004] Work with Dynamic Data in D3
[005] Add Inline Styling to Elements
[006] Change Styles Based on Data
[007] Add Classes with D3
[008] Update the Height of an Element Dynamically
[009] Change the Presentation of a Bar Chart
[010] Learn About SVG in D3
[011] Display Shapes with SVG
[012] Create a Bar for Each Data Point in the Set
[013] Dynamically Set the Coordinates for Each Bar
[014] Dynamically Change the Height of Each Bar
[015] Invert SVG Elements
[016] Change the Color of an SVG Element
[017] Add Labels to D3 Elements
[018] Style D3 Labels
[019] Add a Hover Effect to a D3 Element
[020] Add a Tooltip to a D3 Element
[021] Create a Scatterplot with SVG Circles
[022] Add Attributes to the Circle Elements
[023] Add Labels to Scatter Plot Circles
[024] Create a Linear Scale with D3
[025] Set a Domain and a Range on a Scale
[026] Use the d3.max and d3.min Functions to Find Minimum and Maximum Values in a Dataset
[027] Use Dynamic Scales
[028] Use a Pre-Defined Scale to Place Elements
[029] Add Axes to a Visualization
[X01] コロプレス図 - 地図ファイルの入手
[X02] コロプレス図 - 地図ファイルの展開
[X03] コロプレス図 - コマンドの入手
[X04] コロプレス図 - 地図ファイルの変換
[X05] コロプレス図 - コマンドの入手
[X06] コロプレス図 - 地図ファイルの調査
[X07] コロプレス図 - 地図ファイルの変換
[X08] コロプレス図 - 地図ファイルの各県名を確認
[X09] コロプレス図 - コマンドの入手
[X10] コロプレス図 - コマンドの入手
[X11] コロプレス図 - 地図ファイルの変換
[X12] コロプレス図 - 地図ファイルの軽量化
[X13] コロプレス図 - 地図ファイル(GeoJSON)を描画
[X14] コロプレス図 - 地図ファイル(TopoJSON)を描画
[X15] コロプレス図 - 各県のデータ作成
[X16] コロプレス図 - 地図(GeoJSON)を人口密度に応じて着色
[X17] コロプレス図 - 地図(TopoJSON)を人口密度に応じて着色
[X18] コロプレス図 - FCC課題
================================================================================
[001]
  Add Document Elements with D3
  
[内容]
  要素追加
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 要素追加
    const Element1 = d3
      .select('body')
      .append('p')
      .text('Hello1');
    
    // 要素追加
    const Element2 = d3
      .select('body')
      .append('p')
      .text('Hello2');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[002]
  Select a Group of Elements with D3
  
[内容]
  要素をグループ単位で操作
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 要素追加
    const Element1 = d3
      .select('body')
      .append('p')
      .text('Hello1');
    
    // 要素追加
    const Element2 = d3
      .select('body')
      .append('p')
      .text('Hello2');
    
    // 追加要素をグループ単位で操作
    const Controls = d3
      .selectAll('p')
      .text('D3 Items')
      .style('color', 'Crimson');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[003]
  Work with Data in D3
  
[内容]
  配列データ分の要素作成
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 配列データ
    const ARR = [
      'Hello',
      'Hello',
      'Hello'
    ];
    
    // 要素追加
    const Element1 = d3
      .select('body')
      .append('div');
    
    // 追加要素上に配列データ分の要素作成
    Element1
      .selectAll('div')
      .data(ARR)
      .enter()
      .append('p')
      .text(val => val + ' World')
      .style('color', 'red');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[004]
  Work with Dynamic Data in D3
  
[内容]
  配列データを各要素に反映
  
[確認]
  // 上記「03」を参照
  
================================================================================
[005]
  Add Inline Styling to Elements
  
[内容]
  要素にインラインCSS適用
  
  (例)
  Element1
    .selectAll('div')
    .data(ARR)
    .enter()
    .append('p')
    .text(val => val + ' World')
    .style('color', 'red');  // 該当個所
  
[確認]
  // 上記「03」を参照
  
================================================================================
[006]
  Change Styles Based on Data
  
[内容]
  要素に条件付きでインラインCSS適用
  
  (例)
  Element1
    .selectAll('div')
    .data(ARR)
    .enter()
    .append('p')
    .text(val => val + ' World')
    .style('color', (val, idx) => { if (idx % 2 === 0) return 'red'; });  // 修正
  
[確認]
  // 上記「03」を参照
  
================================================================================
[007]
  Add Classes with D3
  
[内容]
  要素にクラスCSS適用
  
  (例)
  Element1
    .selectAll('div')
    .data(ARR)
    .enter()
    .append('p')
    .text(val => val + ' World')
    .attr('class', (val, idx) => (idx % 2 === 0) ? クラス名 : クラス名);  // 修正
  
[確認]
  // 上記「03」を参照
  
================================================================================
[008]
  Update the Height of an Element Dynamically
  
[内容]
  配列データとCSSプロパティ「height」で棒グラフ作成
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    .CLASS {
      width: 25px;
      height: 100px;
      display: inline-block;
      background-color: CornFlowerBlue;
    }
    
  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 配列データ
    const DATA = [ 25, 50, 75, 100, 125, 150, 175, 200, 225 ];
    
    // 配列データとCSSプロパティ「height」で棒グラフ作成
    const DOMS = d3
      .select('body')
      .selectAll('BARS')
      .data(DATA)
      .enter()
      .append('div')
      .attr('class', 'CLASS')
      .style('height', val => val + 'px');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[009]
  Change the Presentation of a Bar Chart
  
[内容]
  棒グラフ修正
    各バーの間隔を「2px」空ける => プロパティ「margin」で対応
    各バー同士のコントラスト強化 => プロパティ「height」の数値を2.5倍
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    .CLASS {
      width: 25px;
      height: 100px;
      margin: 2px;  /* 各バーの間隔を「2px」空ける */
      display: inline-block;
      background-color: CornFlowerBlue;
    }

  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 配列データ
    const DATA = [ 25, 50, 75, 100, 125, 150, 175, 200, 225 ];
    
    // 棒グラフ修正
    const DOMS = d3
      .select('body')
      .selectAll('BARS')
      .data(DATA)
      .enter()
      .append('div')
      .attr('class', 'CLASS')
      .style('height', val => val * 2 + 'px');  // 各バー同士のコントラスト強化
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[010]
  Learn About SVG in D3
  
[内容]
  SVG要素を追加
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }
    
  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[011]
  Display Shapes with SVG
  
[内容]
  SVG要素に長方形を追加
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }

  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    
    // カラー配列
    const COLOR = d3.schemeCategory10;
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // SVG要素に長方形を追加
    SVG
      .selectAll('RECT')
      .data([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
      .enter()
      .append('rect')
      .attr('x', (val, idx) => 10 + idx * 50)
      .attr('y', 10)
      .attr('width', 50)
      .attr('height', 50)
      .attr('fill', (val, idx) => COLOR[idx])
      .attr('stroke', 'White')
      .attr('stroke-width', '5');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[012]
  Create a Bar for Each Data Point in the Set
  
[内容]
  SVG要素に長方形で棒グラフを描画(1)
    完成形
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }

    .tooltip {
      position: absolute;
      width: 50px;
      height: 50px;
      padding: 5px;
      text-align: center;
      border: 2px solid White;
      border-radius: 10px;
      font-size: 20px;
      color: White;
      background-color: Black;
    }

    .bar:hover {
      color: White;
      fill: Black
    }

  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    
    // カラー配列
    const COLOR = d3.schemeCategory10;
    
    // データセット
    const DATA = [
      { name: 'A', height: 100 },
      { name: 'B', height: 150 },
      { name: 'C', height: 200 },
      { name: 'D', height: 250 },
      { name: 'E', height: 300 },
      { name: 'F', height: 350 },
      { name: 'G', height: 400 },
      { name: 'H', height: 450 },
      { name: 'I', height: 500 },
      { name: 'J', height: 550 }
    ];
    
    // ツールチップ
    const TOOLTIP = d3
      .select('body')
      .append('div')
      .attr('class', 'tooltip')
      .style('opacity', '0');
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // 棒グラフの幅
    const WIDTH = W / DATA.length;
    
    // SVG要素に長方形を追加
    SVG
      .selectAll('AAA')
      .data(DATA)
      .enter()
      .append('rect')
      .attr('x', (val, idx) => idx * WIDTH)
      .attr('y', (val, idx) => H - val.height)
      .attr('width', WIDTH)
      .attr('height', (val, idx) => val.height)
      .attr('fill', (val, idx) => COLOR[idx])
      .attr('stroke', 'White')
      .attr('stroke-width', '5')
      .attr('class', 'bar')
      .on('mouseover', (val, idx) => {
        TOOLTIP.text(val.height);
        TOOLTIP.style('opacity', '1');
      })
      .on('mouseout', (val, idx) => TOOLTIP.style('opacity', '0'))
      .on('mousemove', (val, idx) => {
        TOOLTIP.style('top', `${d3.event.pageY}px`);
        TOOLTIP.style('left', `${d3.event.pageX}px`);
      });
    
    // SVG要素にテキストを追加
    SVG
      .selectAll('BBB')
      .data(DATA)
      .enter()
      .append('text')
      .attr('x', (val, idx) => idx * WIDTH + 25)
      .attr('y', H - 20)
      .attr('fill', 'White')
      .attr('stroke', 'White')
      .text(val => val.name)
      .style('font-size', '30px');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[013]
  Dynamically Set the Coordinates for Each Bar
  
[内容]
  SVG要素に長方形で棒グラフを描画(2)
    棒グラフのX座標を調節
  
[確認]
  // 上記「12」を参照
  
================================================================================
[014]
  Dynamically Change the Height of Each Bar
  
[内容]
  SVG要素に長方形で棒グラフを描画(3)
    棒グラフのY座標を調節(ただし上下逆さま)
  
[確認]
  // 上記「12」を参照
  
================================================================================
[015]
  Invert SVG Elements
  
[内容]
  SVG要素に長方形で棒グラフを描画(4)
    棒グラフのY座標を調節(上下逆さまを修正)
  
[確認]
  // 上記「12」を参照
  
================================================================================
[016]
  Change the Color of an SVG Element
  
[内容]
  SVG要素に長方形で棒グラフを描画(5)
    棒グラフのY座標を調節(各長方形の色を修正)
  
[確認]
  // 上記「12」を参照
  
================================================================================
[017]
  Add Labels to D3 Elements
  
[内容]
  SVG要素に長方形で棒グラフを描画(6)
    棒グラフにラベルを付与
  
[確認]
  // 上記「12」を参照
  
================================================================================
[018]
  Style D3 Labels
  
[内容]
  SVG要素に長方形で棒グラフを描画(7)
    棒グラフのラベルにCSS適用
  
[確認]
  // 上記「12」を参照
  
================================================================================
[019]
  Add a Hover Effect to a D3 Element
  
[内容]
  SVG要素に長方形で棒グラフを描画(8)
    マウスオーバー時に該当バーの色変更
  
[確認]
  // 上記「12」を参照
  
================================================================================
[020]
  Add a Tooltip to a D3 Element
  
[内容]
  SVG要素に長方形で棒グラフを描画(9)
    マウスオーバー時にツールチップ表示
  
[確認]
  // 上記「12」を参照
  
================================================================================
[021]
  Create a Scatterplot with SVG Circles
  
[内容]
  SVG要素に円形の点で散布図を作成(1)
    完成形
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }
    
    .tooltip {
      position: absolute;
      width: 100px;
      height: 50px;
      padding: 5px;
      text-align: center;
      border: 2px solid White;
      border-radius: 10px;
      font-size: 20px;
      color: White;
      background-color: Black;
    }
    
    .bar:hover {
      color: White;
      fill: Black
    }

  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    
    // カラー配列
    const COLOR = d3.schemeCategory10;
    
    // データセット
    const DATA = [
      { name: 'A', height: 100 },
      { name: 'B', height: 150 },
      { name: 'C', height: 200 },
      { name: 'D', height: 250 },
      { name: 'E', height: 300 },
      { name: 'F', height: 350 },
      { name: 'G', height: 400 },
      { name: 'H', height: 450 },
      { name: 'I', height: 500 },
      { name: 'J', height: 550 }
    ];
    
    // ツールチップ
    const TOOLTIP = d3
      .select('body')
      .append('div')
      .attr('class', 'tooltip')
      .style('opacity', '0');
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // 各点の間隔
    const WIDTH = W / DATA.length;
    
    // SVG要素に円形の点を追加
    SVG
      .selectAll('AAA')
      .data(DATA)
      .enter()
      .append('circle')
      .attr('cx', (val, idx) => 40 + idx * WIDTH)
      .attr('cy', (val, idx) => H - val.height)
      .attr('r', 15)
      .attr('stroke', 'Black')
      .attr('stroke-width', '3px')
      .attr('fill', (val, idx) => COLOR[idx])
      .on('mouseover', (val, idx) => {
        TOOLTIP.text(val.height);
        TOOLTIP.style('opacity', '1');
      })
      .on('mouseout', (val, idx) => TOOLTIP.style('opacity', '0'))
      .on('mousemove', (val, idx) => {
        TOOLTIP.style('top', `${d3.event.pageY}px`);
        TOOLTIP.style('left', `${d3.event.pageX}px`);
      });
    
    // SVG要素にテキストを追加
    SVG
      .selectAll('BBB')
      .data(DATA)
      .enter()
      .append('text')
      .attr('x', (val, idx) => 30 + idx * WIDTH)
      .attr('y', (val, idx) => 50 + H - val.height)
      .attr('fill', 'Black')
      .attr('stroke', 'Black')
      .text(val => val.name)
      .style('font-size', '30px');
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[022]
  Add Attributes to the Circle Elements
  
[内容]
  SVG要素に円形の点で散布図を作成(2)
    各点に属性追加を行い可視化
  
[確認]
  // 上記「21」を参照
  
================================================================================
[023]
  Add Labels to Scatter Plot Circles
  
[内容]
  SVG要素に円形の点で散布図を作成(3)
    各点の右側に座標をラベル表示
  
[確認]
  // 上記「21」を参照
  
================================================================================
[024]
  Create a Linear Scale with D3
  
[内容]
  画面サイズをオーバーする単位の値を目盛(スケール)で表現する(1)
    完成形
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }

    .tooltip {
      position: absolute;
      width: 50px;
      height: 50px;
      padding: 5px;
      text-align: center;
      border: 2px solid White;
      border-radius: 10px;
      font-size: 20px;
      color: White;
      background-color: Black;
    }

    .axis path {
      stroke: Black;
    }

    .axis line {
      stroke: Black;
    }

    .axis text {
      fill: Black;
      font-size: 15px;
      font-weight: bold;
    }

    .bar:hover {
      color: White;
      fill: Black
    }

  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    const P = 60;
    
    // カラー配列
    const COLOR = d3.schemeCategory10;
    
    // データセット => 値を画面サイズ外の10倍に変更する
    const DATA = [
      { name: 'A', height: 1000 },
      { name: 'B', height: 1500 },
      { name: 'C', height: 2000 },
      { name: 'D', height: 2500 },
      { name: 'E', height: 3000 },
      { name: 'F', height: 3500 },
      { name: 'G', height: 4000 },
      { name: 'H', height: 4500 },
      { name: 'I', height: 5000 },
      { name: 'J', height: 5500 }
    ];
    
    // ツールチップ
    const TOOLTIP = d3
      .select('body')
      .append('div')
      .attr('class', 'tooltip')
      .style('opacity', '0');
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // 凡例 - 領域作成
    const LGND = SVG
      .selectAll('AAA')
      .data(DATA.map(val => val.name))
      .enter()
      .append('g')
      .attr('transform', (val, idx) => `translate(${P + 20}, ${P + idx * 30})`);
      
    // 凡例 - 四角
    LGND
      .append('rect')
      .attr('x', 0)
      .attr('y', 0)
      .attr('width', 20)
      .attr('height', 20)
      .style('fill', (val, idx) => COLOR[idx]);
    
    // 凡例 - 文言
    LGND
      .append('text')
      .attr('x', 30)
      .attr('y', 17)
      .text(val => val)
      .style('text-anchor', 'start')
      .style('font-size', '20px');
    
    // X軸 - 変換関数
    const FUNC_X = d3
      .scaleBand()
      .domain(DATA.map(val => val.name))
      .range([P, W - P]);
    
    // X軸 - 目盛(スケール)
    const SCALE_X = d3
      .axisBottom()
      .scale(FUNC_X);
    
    // X軸 - 描画
    SVG
      .append('g')
      .call(SCALE_X)
      .attr('class', 'axis')
      .attr('transform', `translate(0, ${H - P})`);
    
    // Y軸 - 変換関数
    const FUNC_Y = d3
      .scaleLinear()
      .domain([
        d3.min(DATA.map(val => val.height)) - 500,
        d3.max(DATA.map(val => val.height)) + 500
      ])
      .range([H - P, P]);
    
    // Y軸 - 目盛(スケール)
    const SCALE_Y = d3
      .axisLeft()
      .scale(FUNC_Y);
    
    // Y軸 - 描画
    SVG
      .append('g')
      .call(SCALE_Y)
      .attr('class', 'axis')
      .attr('transform', `translate(${P}, 0)`);
    
    // 棒グラフの幅
    const WIDTH = (W - P - P) / DATA.length;
    
    // SVG要素に長方形を追加
    SVG
      .selectAll('BBB')
      .data(DATA)
      .enter()
      .append('rect')
      .attr('x', (val, idx) => P + idx * WIDTH)
      .attr('y', (val, idx) => FUNC_Y(val.height))
      .attr('width', WIDTH)
      .attr('height', (val, idx) => H - FUNC_Y(val.height) - P)
      .attr('fill', (val, idx) => COLOR[idx])
      .attr('stroke', 'White')
      .attr('class', 'bar')
      .on('mouseover', (val, idx) => {
        TOOLTIP.text(val.height);
        TOOLTIP.style('opacity', '1');
      })
      .on('mouseout', (val, idx) => TOOLTIP.style('opacity', '0'))
      .on('mousemove', (val, idx) => {
        TOOLTIP.style('top', `${d3.event.pageY}px`);
        TOOLTIP.style('left', `${d3.event.pageX}px`);
      });
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[025]
  Set a Domain and a Range on a Scale
  
[内容]
  画面サイズをオーバーする単位の値を目盛(スケール)で表現する(2)
    スケールの変換設定
  
  (例1)
  const FUNC_X = d3                     // 変換関数(X軸)
    .scaleBand()                        // 
    .domain(DATA.map(val => val.name))  // 入力データ範囲を指定
    .range([P, W - P]);                 // 出力データ範囲を指定
  
  (例2)
  const FUNC_Y = d3                               // 変換関数(Y軸)
    .scaleLinear()                                // 
    .domain([                                     // 
      d3.min(DATA.map(val => val.height)) - 500,  // 入力データ範囲(Y軸の下側)
      d3.max(DATA.map(val => val.height)) + 500   // 入力データ範囲(Y軸の上側)
    ])                                            // 
    .range([H - P, P]);                           // 出力データ範囲
  
[確認]
  // 上記「24」を参照
  
================================================================================
[026]
  Use the d3.max and d3.min Functions to Find Minimum and Maximum Values in a Dataset
  
[内容]
  画面サイズをオーバーする単位の値を目盛(スケール)で表現する(3)
    スケールの変換設定時に最大値と最小値を指定
  
  (例)
  const FUNC_Y = d3                               // 変換関数(Y軸)
    .scaleLinear()                                // 
    .domain([                                     // 
      d3.min(DATA.map(val => val.height)) - 500,  // 最小値(Y軸の下側)
      d3.max(DATA.map(val => val.height)) + 500   // 最大値(Y軸の上側)
    ])                                            // 
    .range([H - P, P]);                           // 
  
[確認]
  // 上記「24」を参照
  
================================================================================
[027]
  Use Dynamic Scales

[内容]
  画面サイズをオーバーする単位の値を目盛(スケール)で表現する(4)
    最大値と最小値の効果的な使用
  
[確認]
  // 上記「24」を参照
  
================================================================================
[028]
  Use a Pre-Defined Scale to Place Elements
  
[内容]
  画面サイズをオーバーする単位の値を目盛(スケール)で表現する(5)
    目盛(スケール)を使用して棒グラフを描画
  
[確認]
  // 上記「24」を参照
  
================================================================================
[029]
  Add Axes to a Visualization
  
[内容]
  画面サイズをオーバーする単位の値を目盛(スケール)で表現する(6)
    棒グラフに目盛(スケール)を追加
  
[確認]
  // 上記「24」を参照
  
================================================================================
[X01]
  コロプレス図 - 地図ファイルの入手
  
[内容]
  コマンド「wget」で地図ファイル(Shape)の入手
  
[確認]
  # cd /var/www/html
  # wget https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_1_states_provinces.zip
  
  コマンドの実行結果
  --------------------------------------------------
  2021-06-03 14:25:38 (3.07 MB/s) - `ne_10m_admin_1_states_provinces.zip' へ保存完了
  --------------------------------------------------
  
  # cd /var/www/html
  # ls -lh ne_10m*
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 14M 10月 10  2019 ne_10m_admin_1_states_provinces.zip
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X02]
  コロプレス図 - 地図ファイルの展開
  
[内容]
  コマンド「unzip」で地図ファイル(Shape)の展開
  
[確認]
  # cd /var/www/html
  # unzip ne_10m_admin_1_states_provinces.zip
  
  コマンドの実行結果
  --------------------------------------------------
  Archive:  ne_10m_admin_1_states_provinces.zip
  inflating: ne_10m_admin_1_states_provinces.README.html
  extracting: ne_10m_admin_1_states_provinces.VERSION.txt
  extracting: ne_10m_admin_1_states_provinces.cpg
  inflating: ne_10m_admin_1_states_provinces.dbf
  inflating: ne_10m_admin_1_states_provinces.prj
  inflating: ne_10m_admin_1_states_provinces.shp  // 地図ファイル(Shape)
  inflating: ne_10m_admin_1_states_provinces.shx
  --------------------------------------------------
  
  # cd /var/www/html
  # ls -l *.shp
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 21M  5月 21  2018 ne_10m_admin_1_states_provinces.shp
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X03]
  コロプレス図 - コマンドの入手
  
[内容]
  パッケージ「gdal」のインストール
  
[確認]
  # cd
  # yum -y install gdal
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  # cd
  # which ogr2ogr
  
  コマンドの実行結果
  --------------------------------------------------
  /usr/bin/ogr2ogr
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X04]
  コロプレス図 - 地図ファイルの変換
  
[内容]
  コマンド「ogr2ogr」で地図ファイル(Shape)を「GeoJSON」に変換
  
[確認]
  # cd /var/www/html
  # ogr2ogr -f GeoJSON ne_10m_admin_1_states_provinces.geojson ne_10m_admin_1_states_provinces.shp
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  # cd /var/www/html
  # ls -lh ne_10m_admin_1_states_provinces.geojson
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 64M  6月  3 14:58 ne_10m_admin_1_states_provinces.geojson
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X05]
  コロプレス図 - コマンドの入手
  
[内容]
  パッケージ「jq」のインストール
  
[確認]
  # cd
  # yum -y install jq
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  # cd
  # which jq
  
  コマンドの実行結果
  --------------------------------------------------
  /usr/bin/jq
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X06]
  コロプレス図 - 地図ファイルの調査
  
[内容]
  コマンド「jq」で地図ファイル(GeoJSON)から「日本」のみの情報の抽出条件を調査
  
[確認]
  # cd /var/www/html
  # jq .(ルート) ne_10m_admin_1_states_provinces.geojson | grep -i japan
  
  コマンドの実行結果
  --------------------------------------------------
  ...
  
  // 埼玉県
  "woe_label": "Saitama Prefecture, JP, Japan",
  "admin": "Japan",
  "geonunit": "Japan",

  // 山梨県
  "woe_label": "Yamanashi Prefecture, JP, Japan",
  "admin": "Japan",
  "geonunit": "Japan",

  // 奈良県
  "woe_label": "Nara Prefecture, JP, Japan",
  "admin": "Japan",
  "geonunit": "Japan",
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X07]
  コロプレス図 - 地図ファイルの変換
  
[内容]
  コマンド「ogr2ogr」で地図ファイル(Shape)から「日本」のみ抽出して「GeoJSON」に変換
  
[確認]
  # cd /var/www/html
  # ogr2ogr -f GeoJSON -where 'geonunit = "Japan"' japan.geojson ne_10m_admin_1_states_provinces.shp
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  # cd /var/www/html
  # ls -lh japan.geojson
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 646K  6月  3 19:48 japan.geojson
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X08]
  コロプレス図 - 地図ファイルの各県名を確認
  
[内容]
  コマンド「jq」で地図ファイル(GeoJSON)から各県名を確認
  
[確認]
  # cd /var/www/html
  # jq .features[].properties.name_local japan.geojson
  
  コマンドの実行結果
  --------------------------------------------------
  "鹿児島県"
  "大分県"
  "福岡県"
  "佐賀県"
  "長崎県"
  "熊本県"
  "宮崎県"
  "徳島県"
  "香川県"
  "愛媛県"
  "高知県"
  "島根県"
  "山口県"
  "鳥取県"
  "兵庫県"
  "京都府"
  "福井県"
  "石川県"
  "富山県"
  "新潟県"
  "山形県"
  "秋田県"
  "青森県"
  "岩手県"
  "宮城県"
  "福島県"
  "茨城県"
  "千葉県"
  "東京都"
  "神奈川県"
  null  // 静岡県が抜けている
  "愛知県"
  "三重県"
  "和歌山県"
  "大阪府"
  "岡山県"
  "広島県"
  "北海道"
  "沖縄県"
  "群馬県"
  "長野県"
  "栃木県"
  "岐阜県"
  "滋賀県"
  "埼玉県"
  "山梨県"
  "奈良県"
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X09]
  コロプレス図 - コマンドの入手
  
[内容]
  パッケージ「npm」のインストール
  
[確認]
  # cd
  # yum -y install npm
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  # cd
  # which npm
  
  コマンドの実行結果
  --------------------------------------------------
  /root/.nvm/versions/node/v15.0.1/bin/npm
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X10]
  コロプレス図 - コマンドの入手
  
[内容]
  パッケージ「topojson」をインストール
  
[確認]
  # cd
  # npm -g install topojson
  
  コマンドの実行結果
  --------------------------------------------------
  npm WARN deprecated topojson@3.0.2: Use topojson-client, topojson-server or topojson-simplify directly.
  added 5 packages, and audited 6 packages in 2s
  
  found 0 vulnerabilities
  npm notice 
  npm notice New minor version of npm available! 8.5.5 -> 8.12.2
  npm notice Changelog: https://github.com/npm/cli/releases/tag/v8.12.2
  npm notice Run npm install -g npm@8.12.2 to update!
  npm notice 
  --------------------------------------------------
  
  # cd
  # which geo2topo
  
  コマンドの実行結果
  --------------------------------------------------
  /usr/local/bin/geo2topo
  --------------------------------------------------
  
  # cd
  # which toposimplify
  
  コマンドの実行結果
  --------------------------------------------------
  /usr/local/bin/toposimplify
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X11]
  コロプレス図 - 地図ファイルの変換
  
[内容]
  コマンド「geo2topo」で地図ファイル(GeoJSON)を「TopoJSON」に変換
  
[確認]
  # cd /var/www/html
  # geo2topo -q 1e6 japan.geojson > japan.topojson
  
  コマンドの実行結果
  --------------------------------------------------
  (出力なし)
  --------------------------------------------------
  
  # cd /var/www/html
  # ls -lh japan*
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 646K  6月  3 19:48 japan.geojson
  -rw-r--r--. 1 root root 193K  6月  3 23:50 japan.topojson
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X12]
  コロプレス図 - 地図ファイルの軽量化
  
[内容]
  コマンド「toposimplify」で地図ファイル(TopoJSON)を更に軽量化
  
[確認]
  # cd /var/www/html
  # toposimplify -P 0.05 -f japan.topojson > japan_sim.topojson
  
  コマンドの実行結果
  --------------------------------------------------
  equivalent --planar-area 0.008600227968788052
  --------------------------------------------------
  
  # cd /var/www/html
  # ls -lh japan*
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 646K  6月  3 19:48 japan.geojson
  -rw-r--r--. 1 root root 193K  6月  3 23:50 japan.topojson
  -rw-r--r--. 1 root root  94K  6月  4 07:46 japan_sim.topojson
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X13]
  コロプレス図 - 地図ファイル(GeoJSON)を描画
  
[内容]
  SVG要素に地図描画
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }
    
    .AAA:hover {
      color: White;
      fill: Black
    }
    
  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    const P = 60;
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // 地図 - ファイル
    const FILE = 'japan.geojson';
    
    // 地図 - 投影方法
    const PROJ = d3
      .geoMercator()
      .center([137, 37])
      .translate([W/2, H/2])
      .scale(2000);
    
    // 地図 - 変換式(PATH)
    const PATH = d3
      .geoPath()
      .projection(PROJ);
    
    // 地図 - 描画
    d3.json(FILE).then(JSON => {
      SVG
        .selectAll('path')
        .data(JSON.features)
        .enter()
        .append('path')
        .attr('d', PATH)
        .attr('fill', 'CornFlowerBlue')
        .attr('class', 'AAA')
        .attr('stroke', 'White')
        .attr('stroke-width', '1');
    });
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X14]
  コロプレス図 - 地図ファイル(TopoJSON)を描画
  
[内容]
  SVG要素に地図描画
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }
    
    .AAA:hover {
      color: White;
      fill: Black
    }
    
  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    const P = 60;
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // 地図 - ファイル「japan_sim.topojson」でもOK
    const FILE = 'japan.topojson';
    
    // 地図 - 投影方法
    const PROJ = d3
      .geoMercator()
      .center([137, 37])
      .translate([W/2, H/2])
      .scale(2000);
    
    // 地図 - 変換式(PATH)
    const PATH = d3
      .geoPath()
      .projection(PROJ);
    
    // 地図 - 描画
    d3.json(FILE).then(JSON => {
      SVG
        .selectAll('path')
        .data(topojson.feature(JSON, JSON.objects.japan).features)
        .enter()
        .append('path')
        .attr('d', PATH)
        .attr('fill', 'CornFlowerBlue')
        .attr('class', 'AAA')
        .attr('stroke', 'White')
        .attr('stroke-width', '1');
    });
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X15]
  コロプレス図 - 各県のデータ作成
  
[内容]
  各県の人口密度(2021年4月時点)
  
[確認]
  # cd /var/www/html
  # vi data.csv
  
  コマンドの実行結果
  --------------------------------------------------
  STATE,VALUE
  東京都,6367.78
  大阪府,4627.76
  神奈川県,3813.63
  埼玉県,1933.63
  愛知県,1457.77
  千葉県,1217.90
  福岡県,1024.12
  兵庫県,647.41
  沖縄県,639.12
  京都府,556.88
  香川県,505.55
  茨城県,468.09
  静岡県,465.32
  奈良県,358.44
  滋賀県,351.58
  佐賀県,331.39
  広島県,329.60
  長崎県,317.28
  宮城県,314.83
  三重県,306.11
  群馬県,302.78
  栃木県,301.51
  石川県,269.97
  岡山県,264.59
  富山県,243.59
  熊本県,234.28
  愛媛県,233.69
  山口県,219.47
  和歌山県,193.47
  岐阜県,185.87
  福井県,182.00
  山梨県,180.55
  大分県,177.42
  新潟県,174.81
  徳島県,173.94
  鹿児島県,172.78
  鳥取県,157.22
  長野県,149.99
  宮崎県,137.52
  福島県,132.77
  青森県,127.57
  山形県,114.23
  島根県,99.43
  高知県,97.10
  秋田県,81.81
  岩手県,79.36
  北海道,66.47
  --------------------------------------------------
  
  # cd /var/www/html
  # ls -lh data.csv
  
  コマンドの実行結果
  --------------------------------------------------
  -rw-r--r--. 1 root root 822  6月  6 11:28 data.csv
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X16]
  コロプレス図 - 地図(GeoJSON)を人口密度に応じて着色
  
[内容]
  SVG要素を人口密度に応じて着色、ツールチップ・凡例・ズーム機能を追加
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }
    
    .tooltip {
      position: absolute;
      width: 100px;
      height: 50px;
      padding: 5px;
      text-align: center;
      border: 2px solid White;
      border-radius: 10px;
      font-size: 20px;
      color: White;
      background-color: Black;
    }
    
    .AAA:hover {
      color: White;
      fill: Black
    }
    
  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    const P = 60;
    
    // カラー関数
    const COLOR = d3
      .scaleLinear()
      .domain([0, 9])
      .range(['Blue', 'Red']);
    
    // 凡例 - 配列
    const ARR = [
      { text: '000 - 100', value: 0 },
      { text: '100 - 200', value: 1 },
      { text: '200 - 300', value: 2 },
      { text: '300 - 400', value: 3 },
      { text: '400 - 500', value: 4 },
      { text: '500 - 600', value: 5 },
      { text: '600 - 700', value: 6 },
      { text: '700 - 800', value: 7 },
      { text: '800 - 900', value: 8 },
      { text: '900 -',     value: 9 },
    ];
    
    // ツールチップ
    const TOOLTIP = d3
      .select('body')
      .append('div')
      .attr('class', 'tooltip')
      .style('opacity', '0');
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // 凡例 - 領域作成
    const LGND = SVG
      .selectAll('AAA')
      .data(ARR)
      .enter()
      .append('g')
      .attr('transform', (val, idx) => `translate(${P + 20}, ${P + idx * 30})`);
      
    // 凡例 - 四角
    LGND
      .append('rect')
      .attr('x', 0)
      .attr('y', 0)
      .attr('width', 20)
      .attr('height', 20)
      .style('fill', (val, idx) => COLOR(val.value));
    
    // 凡例 - 文言
    LGND
      .append('text')
      .attr('x', 30)
      .attr('y', 17)
      .text((val, idx) => val.text)
      .style('text-anchor', 'start')
      .style('font-size', '20px');
    
    // 地図 - ファイル
    const FILE1 = 'japan.geojson';
    const FILE2 = 'data.csv';
    
    // 地図 - 投影方法
    const PROJ = d3
      .geoMercator()
      .center([137, 37])
      .translate([W/2, H/2])
      .scale(2000);
    
    // 地図 - 変換式(PATH)
    const PATH = d3
      .geoPath()
      .projection(PROJ);
    
    // 地図 - 描画
    d3.json(FILE1).then(JSON => {
      d3.csv(FILE2).then(CSV => {
        
        // 各県の人口密度をCSVから取得後にJSONに追加
        for (let i = 0; i < CSV.length; i++) {
          for (let j = 0; j < JSON.features.length; j++) {
            if (CSV[i].STATE === JSON.features[j].properties.name_local) {
              JSON.features[j].properties.population = CSV[i].VALUE;
            }
          }
        }
        
        // SVG要素に描画
        SVG
          .selectAll('path')
          .data(JSON.features)
          .enter()
          .append('path')
          .attr('d', PATH)
          .attr('fill', (val, idx) => {
            let RET = 0;
            if (val.properties.population >= 900) RET = 9;
            if (val.properties.population >= 800 && val.properties.population < 900) RET = 8;
            if (val.properties.population >= 700 && val.properties.population < 800) RET = 7;
            if (val.properties.population >= 600 && val.properties.population < 700) RET = 6;
            if (val.properties.population >= 500 && val.properties.population < 600) RET = 5;
            if (val.properties.population >= 400 && val.properties.population < 500) RET = 4;
            if (val.properties.population >= 300 && val.properties.population < 400) RET = 3;
            if (val.properties.population >= 200 && val.properties.population < 300) RET = 2;
            if (val.properties.population >= 100 && val.properties.population < 200) RET = 1;
            if (val.properties.population >= 0   && val.properties.population < 100) RET = 0;
            return COLOR(RET);
          })
          .on('mouseover', (val, idx) => {
            TOOLTIP.text(val.properties.name_ja + '\n' + val.properties.population);
            TOOLTIP.style('opacity', '1');
          })
          .on('mouseout', (val, idx) => TOOLTIP.style('opacity', '0'))
          .on('mousemove', (val, idx) => {
            TOOLTIP.style('top', d3.event.pageY + 'px');
            TOOLTIP.style('left', d3.event.pageX + 'px');
          })
          .attr('class', 'AAA')
          .attr('stroke', 'White')
          .attr('stroke-width', '1');
          
      })
    });
    
    // ズーム - イベント定義
    const ZOOM = d3
      .zoom()
      .scaleExtent([0, 2])
      .on('zoom', () => { SVG.selectAll('path').attr('transform', d3.event.transform); });
    
    // ズーム - イベント登録
    SVG.call(ZOOM);
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X17]
  コロプレス図 - 地図(TopoJSON)を人口密度に応じて着色
  
[内容]
  SVG要素を人口密度に応じて着色、ツールチップ・凡例・ズーム機能を追加
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }
    
    .tooltip {
      position: absolute;
      width: 100px;
      height: 50px;
      padding: 5px;
      text-align: center;
      border: 2px solid White;
      border-radius: 10px;
      font-size: 20px;
      color: White;
      background-color: Black;
    }
    
    .AAA:hover {
      color: White;
      fill: Black
    }
    
  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script> 
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 800;
    const H = 600;
    const P = 60;
    
    // カラー関数
    const COLOR = d3
      .scaleLinear()
      .domain([0, 9])
      .range(['Blue', 'Red']);
    
    // 凡例 - 配列
    const ARR = [
      { text: '000 - 100', value: 0 },
      { text: '100 - 200', value: 1 },
      { text: '200 - 300', value: 2 },
      { text: '300 - 400', value: 3 },
      { text: '400 - 500', value: 4 },
      { text: '500 - 600', value: 5 },
      { text: '600 - 700', value: 6 },
      { text: '700 - 800', value: 7 },
      { text: '800 - 900', value: 8 },
      { text: '900 -',     value: 9 },
    ];
    
    // ツールチップ
    const TOOLTIP = d3
      .select('body')
      .append('div')
      .attr('class', 'tooltip')
      .style('opacity', '0');
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .style('display', 'block')
      .style('width', `${W}px`)
      .style('height', `${H}px`)
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // 凡例 - 領域作成
    const LGND = SVG
      .selectAll('AAA')
      .data(ARR)
      .enter()
      .append('g')
      .attr('transform', (val, idx) => `translate(${P + 20}, ${P + idx * 30})`);
    
    // 凡例 - 四角
    LGND
      .append('rect')
      .attr('x', 0)
      .attr('y', 0)
      .attr('width', 20)
      .attr('height', 20)
      .style('fill', (val, idx) => COLOR(val.value));
    
    // 凡例 - 文言
    LGND
      .append('text')
      .attr('x', 30)
      .attr('y', 17)
      .text((val, idx) => val.text)
      .style('text-anchor', 'start')
      .style('font-size', '20px');
    
    // 地図 - ファイル
    const FILE1 = 'japan.topojson';
    const FILE2 = 'data.csv';
    
    // 地図 - 投影方法
    const PROJ = d3
      .geoMercator()
      .center([137, 37])
      .translate([W/2, H/2])
      .scale(2000);
    
    // 地図 - 変換式(PATH)
    const PATH = d3
      .geoPath()
      .projection(PROJ);
    
    // 地図 - 描画
    d3.json(FILE1).then(JSON => {
      d3.csv(FILE2).then(CSV => {
        
        // 形式「TopoJSON」を形式「GeoJSON」に変換
        JSON = topojson.feature(JSON, JSON.objects.japan);
        
        // 各県の人口密度をCSVから取得後にJSONに追加
        for (let i = 0; i < CSV.length; i++) {
          for (let j = 0; j < JSON.features.length; j++) {
            if (CSV[i].STATE === JSON.features[j].properties.name_local) {
              JSON.features[j].properties.population = CSV[i].VALUE;
            }
          }
        }
        
        // SVG要素に描画
        SVG
          .selectAll('path')
          .data(JSON.features)
          .enter()
          .append('path')
          .attr('d', PATH)
          .attr('fill', (val, idx) => {
            let RET = 0;
            if (val.properties.population >= 900) RET = 9;
            if (val.properties.population >= 800 && val.properties.population < 900) RET = 8;
            if (val.properties.population >= 700 && val.properties.population < 800) RET = 7;
            if (val.properties.population >= 600 && val.properties.population < 700) RET = 6;
            if (val.properties.population >= 500 && val.properties.population < 600) RET = 5;
            if (val.properties.population >= 400 && val.properties.population < 500) RET = 4;
            if (val.properties.population >= 300 && val.properties.population < 400) RET = 3;
            if (val.properties.population >= 200 && val.properties.population < 300) RET = 2;
            if (val.properties.population >= 100 && val.properties.population < 200) RET = 1;
            if (val.properties.population >= 0   && val.properties.population < 100) RET = 0;
            return COLOR(RET);
          })
          .on('mouseover', (val, idx) => {
            TOOLTIP.text(val.properties.name_ja + '\n' + val.properties.population);
            TOOLTIP.style('opacity', '1');
          })
          .on('mouseout', (val, idx) => TOOLTIP.style('opacity', '0'))
          .on('mousemove', (val, idx) => {
            TOOLTIP.style('top', d3.event.pageY + 'px');
            TOOLTIP.style('left', d3.event.pageX + 'px');
          })
          .attr('class', 'AAA')
          .attr('stroke', 'White')
          .attr('stroke-width', '1');
          
      })
    });
    
    // ズーム - イベント定義
    const ZOOM = d3
      .zoom()
      .scaleExtent([0, 2])
      .on('zoom', () => { SVG.selectAll('path').attr('transform', d3.event.transform); });
    
    // ズーム - イベント登録
    SVG.call(ZOOM);
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
[X18]
  コロプレス図 - FCC課題
  
[内容]
  ネット上の複数のJSONファイルから地図描画 => JSONファイルのどこからデータを取得するかは解答を参照
  
[確認]
  # cd /var/www/html
  # vi sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  <!doctype html>
  <html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>SAMPLE</title>
  
  <!-- CSS --->
  <style>
    
    * {
      font-family: sans-serif;
      background-color: Gray;
    }

    #tooltip {
      position: absolute;
      width: 250px;
      height: 20px;
      padding: 5px;
      text-align: center;
      border: 2px solid White;
      border-radius: 10px;
      font-size: 15px;
      color: White;
      background-color: Black;
    }

    .axis path {
      stroke: Black;
    }

    .axis line {
      stroke: Black;
    }

    .axis text {
      fill: Black;
      font-size: 15px;
      font-weight: bold;
    }

    .county:hover {
      color: White;
      fill: Black
    }

  </style>
  </head>
  <body>
  
  <!-- CDN --->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  
  <!-- D3 --->
  <script>
    
    // 定数
    const W = 1200;
    const H = 900;
    const P = 100;
    
    // カラー関数
    const COLOR = d3
      .scaleThreshold()
      .domain([3, 10, 75])
      .range([
        d3.interpolateGreens(0.1),
        d3.interpolateGreens(0.3),
        d3.interpolateGreens(0.5),
        d3.interpolateGreens(0.7)
      ]);
    
    // ツールチップ
    const TIP = d3
      .select('body')
      .append('div')
      .attr('id', 'tooltip')
      .style('opacity', '0');
    
    // SVG要素を追加
    const SVG = d3
      .select('body')
      .append('svg')
      .attr('width', W)
      .attr('height', H)
      .style('display', 'block')
      .style('background-color', 'White')
      .style('margin', '10% auto');
    
    // タイトル追加
    SVG
      .append('text')
      .attr('x', W / 2)
      .attr('y', P / 2)
      .attr('id', 'title')
      .attr('text-anchor', 'middle')
      .text('United States Educational Attainment')
      .style('font-size', '30px');
    
    // 副題追加
    SVG
      .append('text')
      .attr('x', W / 2)
      .attr('y', P + 10)
      .attr('id', 'description')
      .attr('text-anchor', 'middle')
      .text("Percentage of adults age 25 and older with a bachelor's degree or higher (2010-2014)")
      .style('font-size', '20px');
    
    // 凡例 - 配列と定数
    const ARR = [0.1, 0.3, 0.5, 0.7];
    const BAR = 80;
    
    // 凡例 - 領域作成
    const LGND = SVG
      .append('g')
      .attr('id', 'legend');
    
    // 凡例 - 四角
    LGND
      .selectAll('RECT')
      .data(ARR)
      .enter()
      .append('rect')
      .attr('x', 0)
      .attr('y', 0)
      .attr('width', BAR)
      .attr('height', 20)
      .attr('transform', (d, i) => `translate(${(P + 350) + i * BAR}, ${P + 50})`)
      .style('fill', d => d3.interpolateGreens(d));
    
    // 凡例 - X軸(変換関数)
    const FUNC_X = d3
      .scaleLinear()
      .domain([1, 5])
      .range([P, P + 4 * BAR]);
    
    // 凡例 - X軸(目盛)
    const SCALE_X = d3
      .axisBottom()
      .scale(FUNC_X)
      .ticks(4)
      .tickFormat((d, i) => {
        switch(i) {
          case 0: return '0%';
          case 1: return '3%';
          case 2: return '10%';
          case 3: return '75%';
          case 4: return '100%';
        }
      });
    
    /**/
    // 凡例 - X軸描画
    SVG
      .append('g')
      .call(SCALE_X)
      .attr('class', 'axis')
      .attr('transform', `translate(${P + 250}, ${P + 70})`);
    /**/
    
    // ファイル
    const FILE1 = 'https://cdn.freecodecamp.org/testable-projects-fcc/data/choropleth_map/counties.json';
    const FILE2 = 'https://cdn.freecodecamp.org/testable-projects-fcc/data/choropleth_map/for_user_education.json';
    
    // 描画開始
    d3.json(FILE1).then(MAP => {
      d3.json(FILE2).then(DATA => {
    
        // SVG要素に地図を描画
        SVG
          .selectAll('path')
          .data(topojson.feature(MAP, MAP.objects.counties).features)
          .enter()
          .append('path')
          .attr('d', d3.geoPath())
          .attr('data-fips', d => d.id)
          .attr('data-education', d => {
            const TMP = DATA.filter(OBJ => OBJ.fips === d.id);
            return TMP[0].bachelorsOrHigher;
          })
          .attr('fill', d => {
            const TMP = DATA.filter(OBJ => OBJ.fips === d.id);
            return COLOR(TMP[0].bachelorsOrHigher);
          })
          .on('mouseover', d => {
            const TMP = DATA.filter(OBJ => OBJ.fips === d.id);
            TIP.text(TMP[0].area_name + ',' + TMP[0].state + ',' + TMP[0].bachelorsOrHigher + '%');
            TIP.style('opacity', '1');
            TIP.attr('data-education', TMP[0].bachelorsOrHigher);
          })
          .on('mouseout', d => TIP.style('opacity', '0'))
          .on('mousemove', d => {
            TIP.style('top', d3.event.pageY + 'px');
            TIP.style('left', d3.event.pageX + 'px');
          })
          .attr('class', 'AAA')
          .attr('class', 'county')
          .attr('transform', `translate(${1.2 * P}, ${2.0 * P})`);
          
      });
    });
    
  </script>
  </body>
  </html>
  --------------------------------------------------
  
  # firefox
  # http://localhost/sample.html
  
  コマンドの実行結果
  --------------------------------------------------
  (省略)
  --------------------------------------------------
  
  以後の動作確認に続く
  
================================================================================
